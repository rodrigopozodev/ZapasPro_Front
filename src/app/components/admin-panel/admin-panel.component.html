<div class="flex min-h-screen bg-[#f3e8d5]">
  <!-- Sidebar -->
  <div class="w-1/10 bg-white p-4 rounded-lg shadow-lg border border-yellow-300 fixed h-fit top-1/2 transform -translate-y-1/2">
    <ul class="space-y-4">
      <li>
        <button (click)="showUserSection()" class="w-full text-left text-yellow-700 hover:bg-yellow-100 p-3 rounded-lg transition duration-200">Usuarios</button>
      </li>
      <li>
        <button (click)="showProductSection()" class="w-full text-left text-yellow-700 hover:bg-yellow-100 p-3 rounded-lg transition duration-200">Productos</button>
      </li>
      <li>
        <button (click)="showReceiptSection()" class="w-full text-left text-yellow-700 hover:bg-yellow-100 p-3 rounded-lg transition duration-200">Recibos</button>
      </li>
    </ul>
  </div>

  <!-- Contenido Principal -->
  <div class="flex-1 ml-24 p-12">
    <h1 class="text-3xl font-extrabold text-yellow-600 mb-6 animate-fadeIn text-center">Administración</h1>

    <!-- Sección de usuarios -->
    <div *ngIf="showUsers" [ngClass]="{'animate-fadeIn': showUsers, 'animate-fadeOut': !showUsers}" class="table-container w-full bg-white p-6 rounded-lg shadow-lg mb-10 border border-yellow-300 transition-all duration-500 ease-out transform">
      <h2 class="text-2xl font-bold text-yellow-800 mb-4 text-center">Usuarios</h2>

      <!-- Botón para mostrar el formulario de registro -->
      <div class="flex justify-center">
        <button (click)="showRegisterForm = !showRegisterForm" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200 mb-4">
          Registrar Nuevo Usuario
        </button>
      </div>

      <!-- Formulario de registro de usuario -->
      <div *ngIf="showRegisterForm" class="p-4 border border-yellow-300 rounded-lg bg-yellow-50 mb-6">
        <h3 class="text-xl font-bold text-yellow-600 mb-2">Registrar Nuevo Usuario</h3>
        <form (ngSubmit)="register()">
          <label for="username" class="block mb-2">Nombre de Usuario:</label>
          <input type="text" id="username" [(ngModel)]="username" name="username" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required />

          <label for="email" class="block mb-2">Correo Electrónico:</label>
          <input type="email" id="email" [(ngModel)]="email" name="email" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required />

          <label for="password" class="block mb-2">Contraseña:</label>
          <input type="password" id="password" [(ngModel)]="password" name="password" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required />

          <label for="role" class="block mb-2">Rol:</label>
          <select id="role" [(ngModel)]="role" name="role" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required>
            <option value="admin">Admin</option>
            <option value="client">Cliente</option>
          </select>

          <button type="submit" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200">Registrar Usuario</button>
          <button type="button" (click)="cancelRegister()" class="bg-red-500 text-white hover:bg-red-600 p-2 rounded-lg transition duration-200 ml-2">Cancelar</button>
        </form>
      </div>

      <!-- Paginación -->
      <div class="mt-4 flex justify-center mb-6">
        <button (click)="previousPage()" 
                [disabled]="currentPage === 1" 
                class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200" 
                [ngClass]="{'cursor-not-allowed opacity-50': currentPage === 1}">
          Anterior
        </button>
        <span class="mx-2">Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="nextPage()" 
                [disabled]="currentPage === totalPages" 
                class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200" 
                [ngClass]="{'cursor-not-allowed opacity-50': currentPage === totalPages}">
          Siguiente
        </button>
      </div>

      <!-- Formulario de edición de usuario al principio de la tabla -->
      <div *ngIf="currentUser" class="p-4 border border-yellow-300 rounded-lg bg-yellow-50 mb-6">
        <h3 class="text-xl font-bold text-yellow-600 mb-2">Editar Usuario</h3>
        <form (ngSubmit)="updateUser()">
          <label for="username" class="block mb-2">Nombre de Usuario:</label>
          <input type="text" id="username" [(ngModel)]="currentUser.username" name="username" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required />
      
          <label for="email" class="block mb-2">Email:</label>
          <input type="email" id="email" [(ngModel)]="currentUser.email" name="email" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required />
      
          <label for="role" class="block mb-2">Rol:</label>
          <select id="role" [(ngModel)]="currentUser.role" name="role" class="border border-yellow-300 p-2 w-full rounded-lg mb-4" required>
            <option value="admin">Admin</option>
            <option value="client">Cliente</option>
          </select>

          <button type="submit" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200">Guardar Cambios</button>
          <button type="button" (click)="cancelEdit()" class="bg-red-500 text-white hover:bg-red-600 p-2 rounded-lg transition duration-200 ml-2">Cancelar</button>
          <button type="button" (click)="deleteUser(currentUser.id)" class="bg-red-700 text-white hover:bg-red-800 p-2 rounded-lg transition duration-200 ml-2">Eliminar</button>
        </form>
      </div>

      <!-- Barra de búsqueda y filtros -->
      <div class="flex items-center mb-4">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="filterUsers()" 
          placeholder="Buscar usuario..." 
          class="border border-yellow-300 p-2 rounded-lg w-full mr-2" 
        />

        <select [(ngModel)]="searchBy" (change)="filterUsers()" class="border border-yellow-300 p-2 rounded-lg mr-2">
          <option value="username">Nombre de Usuario</option>
          <option value="email">Email</option>
        </select>

        <select [(ngModel)]="roleFilter" (change)="filterUsers()" class="border border-yellow-300 p-2 rounded-lg">
          <option value="">Todos los Roles</option>
          <option value="admin">Admin</option>
          <option value="client">Cliente</option>
        </select>
      </div>

      <!-- Tabla de usuarios -->
      <table class="min-w-full border-collapse text-center">
        <thead class="bg-yellow-200">
          <tr>
            <th class="border border-yellow-300 p-2">ID</th>
            <th class="border border-yellow-300 p-2">Nombre de Usuario</th>
            <th class="border border-yellow-300 p-2">Email</th>
            <th class="border border-yellow-300 p-2">Rol</th>
            <th class="border border-yellow-300 p-2">Fecha de Creación</th>
            <th class="border border-yellow-300 p-2">Última Actualización</th>
            <th class="border border-yellow-300 p-2">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of paginatedUsers" class="hover:bg-yellow-100 transition duration-300">
            <td class="border border-yellow-300 p-2">{{ user.id }}</td>
            <td class="border border-yellow-300 p-2">{{ user.username }}</td>
            <td class="border border-yellow-300 p-2">{{ user.email }}</td>
            <td class="border border-yellow-300 p-2">{{ user.role }}</td>
            <td class="border border-yellow-300 p-2">{{ user.createdAt | date:'short' }}</td>
            <td class="border border-yellow-300 p-2">{{ user.updatedAt | date:'short' }}</td>
            <td class="border border-yellow-300 p-2">
              <button (click)="editUser(user)" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200">Editar</button>
              <button (click)="deleteUser(user.id)" class="bg-red-500 text-white hover:bg-red-600 p-2 rounded-lg transition duration-200 ml-2">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Sección de productos -->
<div *ngIf="showProducts" [ngClass]="{'animate-fadeIn': showProducts, 'animate-fadeOut': !showProducts}" class="table-container w-full bg-white p-6 rounded-lg shadow-lg mb-10 border border-yellow-300 transition-all duration-500 ease-out transform">
  <h2 class="text-2xl font-bold text-yellow-800 mb-4 text-center">Productos</h2>

  <!-- Paginación para productos -->
  <div class="mt-4 flex justify-center">
    <button (click)="previousProductPage()" 
            [disabled]="currentProductPage === 1" 
            class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200" 
            [ngClass]="{'cursor-not-allowed opacity-50': currentProductPage === 1}">
      Anterior
    </button>
    <span class="mx-2">Página {{ currentProductPage }} de {{ totalProductPages }}</span>
    <button (click)="nextProductPage()" 
            [disabled]="currentProductPage === totalProductPages" 
            class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200" 
            [ngClass]="{'cursor-not-allowed opacity-50': currentProductPage === totalProductPages}">
      Siguiente
    </button>
  </div>

  <!-- Barra de búsqueda y filtros -->
<div class="flex items-center mb-4">
  <input 
    type="text" 
    [(ngModel)]="searchProductTerm" 
    (input)="filterProducts()" 
    placeholder="Buscar producto..." 
    class="border border-yellow-300 p-2 rounded-lg w-full mr-2" 
  />
  <select [(ngModel)]="genderFilter" (change)="filterProducts()" class="border border-yellow-300 p-2 rounded-lg">
    <option value="">Todos los Géneros</option>
    <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
  </select>
  

</div>


  <!-- Tabla de productos -->
  <table class="min-w-full border-collapse text-center">
    <thead class="bg-yellow-200">
      <tr>
        <th class="border border-yellow-300 p-2">ID</th>
        <th class="border border-yellow-300 p-2">Nombre</th>
        <th class="border border-yellow-300 p-2">Descripción</th>
        <th class="border border-yellow-300 p-2">Imagen</th>
        <th class="border border-yellow-300 p-2">Precio</th>
        <th class="border border-yellow-300 p-2">Stock</th>
        <th class="border border-yellow-300 p-2">Género</th>
        <th class="border border-yellow-300 p-2">Tallas</th> <!-- Nueva columna para sizes -->
        <th class="border border-yellow-300 p-2">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of paginatedProducts" class="hover:bg-yellow-100 transition duration-300">
        <td class="border border-yellow-300 p-2">{{ product.id }}</td>
        <td class="border border-yellow-300 p-2">{{ product.name }}</td>
        <td class="border border-yellow-300 p-2">{{ product.description }}</td>
        <td class="border border-yellow-300 p-2">
          <img [src]="product.imageUrl" alt="{{ product.name }}" class="w-16 h-16 object-cover mx-auto" />
        </td>
        <td class="border border-yellow-300 p-2">{{ product.price }} €</td>
        <td class="border border-yellow-300 p-2">{{ product.stock }}</td>
        <td class="border border-yellow-300 p-2">{{ product.gender }}</td>
        <td class="border border-yellow-300 p-2">{{ product.sizes.join(', ') }}</td> <!-- Muestra las tallas -->
        <td class="border border-yellow-300 p-2">
          <button (click)="editProduct(product)" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200">Editar</button>
          <button (click)="deleteProduct(product.id)" class="bg-red-500 text-white hover:bg-red-600 p-2 rounded-lg transition duration-200 ml-2">Eliminar</button>
        </td>
      </tr>
    </tbody>
    
  </table>

   <!-- Formulario de edición de producto -->
   <div *ngIf="isEditing" class="mt-4 bg-gray-100 p-4 rounded-lg">
    <h3 class="text-xl font-semibold text-yellow-800 mb-2">Editar Producto</h3>
    <form (ngSubmit)="updateProduct(selectedProduct?.id)">
      <input type="hidden" [(ngModel)]="selectedProduct.id" name="id" />
      <div class="mb-2">
        <label class="block mb-1" for="name">Nombre</label>
        <input id="name" type="text" [(ngModel)]="selectedProduct.name" name="name" required class="border border-yellow-300 p-2 rounded-lg w-full" />
      </div>
      <div class="mb-2">
        <label class="block mb-1" for="description">Descripción</label>
        <input id="description" type="text" [(ngModel)]="selectedProduct.description" name="description" required class="border border-yellow-300 p-2 rounded-lg w-full" />
      </div>
      <div class="mb-2">
        <label class="block mb-1" for="price">Precio</label>
        <input id="price" type="number" [(ngModel)]="selectedProduct.price" name="price" required class="border border-yellow-300 p-2 rounded-lg w-full" />
      </div>
      <div class="mb-2">
        <label class="block mb-1" for="stock">Stock</label>
        <input id="stock" type="number" [(ngModel)]="selectedProduct.stock" name="stock" required class="border border-yellow-300 p-2 rounded-lg w-full" />
      </div>
      <div class="mb-2">
        <label class="block mb-1" for="gender">Género</label>
        <select id="gender" [(ngModel)]="selectedProduct.gender" name="gender" class="border border-yellow-300 p-2 rounded-lg w-full">
          <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
        </select>
      </div>
      <div class="mb-2">
        <label class="block mb-1" for="sizes">Tallas</label>
        <input id="sizes" type="text" [(ngModel)]="selectedProduct.sizes" name="sizes" required class="border border-yellow-300 p-2 rounded-lg w-full" placeholder="Ejemplo: S, M, L" />
        <small class="text-gray-500">Introduce las tallas separadas por comas</small>
      </div>
      <button type="submit" class="bg-yellow-500 text-white hover:bg-yellow-600 p-2 rounded-lg transition duration-200">Guardar Cambios</button>
      <button (click)="cancelEdit()" type="button" class="bg-gray-400 text-white hover:bg-gray-500 p-2 rounded-lg transition duration-200 ml-2">Cancelar</button>
    </form>
  </div>
  
</div>
</div>


    


  
    <!-- Sección de recibos -->
    <div *ngIf="showReceipts" [ngClass]="{'animate-fadeIn': showReceipts, 'animate-fadeOut': !showReceipts}" class="table-container w-full bg-white p-6 rounded-lg shadow-lg mb-10 border border-yellow-300 transition-all duration-500 ease-out transform">
      <h2 class="text-2xl font-bold text-yellow-800 mb-4 text-center">Recibos</h2>

      <!-- Tabla de recibos -->
      <table class="min-w-full border-collapse text-center">
        <thead class="bg-yellow-200">
          <tr>
            <th class="border border-yellow-300 p-2">ID</th>
            <th class="border border-yellow-300 p-2">Usuario</th>
            <th class="border border-yellow-300 p-2">Total</th>
            <th class="border border-yellow-300 p-2">Fecha</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let receipt of receipts" class="hover:bg-yellow-100 transition duration-300">
            <td class="border border-yellow-300 p-2">{{ receipt.id }}</td>
            <td class="border border-yellow-300 p-2">{{ receipt.user.username }}</td>
            <td class="border border-yellow-300 p-2">{{ receipt.total | currency }}</td>
            <td class="border border-yellow-300 p-2">{{ receipt.createdAt | date:'short' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
